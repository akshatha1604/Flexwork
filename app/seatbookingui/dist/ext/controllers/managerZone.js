sap.ui.define(["sap/ui/model/odata/v4/ODataModel","sap/m/Token","sap/ui/model/json/JSONModel"],function(e,t,a){"use strict";function o(){var e=[];var t=`employeeID_ID eq '${sap.ushell.Container.getService("UserInfo").getId()}'`;$.get({url:"/seat-booking/TeamEmployeeMaster",headers:{"x-csrf-token":"fetch"},data:{$filter:t},success:function(t,a,o){e=t},async:false});if(e.value){if(e.value[0]){return e.value[0]}}}function r(){var e=[];$.get({url:"/seat-booking/TeamMemberRole",success:function(t){e=t},async:false});if(e.value)return e.value}function s(e){var t=e._controller.getView().getModel("modelData").getData();e._controller.getView().getModel("ExistingData").setData(JSON.parse(JSON.stringify(t)))}function n(){var e=[];$.get({url:"/seat-booking/Users",success:function(t){e=t},async:false});if(e.value)return e.value}function l(e){var t;var a=`ID eq '${e}'`;$.get({url:"/seat-booking/Users",data:{$filter:a},success:function(e){t=e},async:false});if(t.value[0])return t.value[0]}function i(e,t){var a;var o=t._controller.getView().getModel("modelData");var r=t._controller.getView().getModel("ExistingData");var s=o.getData();if(s.Seats.length===0){var n=`teamID eq '${s.Property.teamID}'`;$.get({url:"/seat-booking/TeamSeatMapping",data:{$filter:n},success:function(e){a=e},async:false});if(a.value){o.setProperty("/Seats",a.value);r.setProperty("/Seats",JSON.parse(JSON.stringify(a.value)))}}}return{ManagerBtnHandling:function(e){var t=o().role_roleCode;if(t==="01"||t==="03"){return true}else{return false}},openManagerZoneDialog:function(e){var t=o();if(t){if(t.role_roleCode==="01"||o().role_roleCode==="03"){var a=r();var s={radiobutton:[{type:"Update Team Details & Roles"},{type:"Updates seat details"},{type:"Usage analytics"}],userRoleDetails:a,Property:{EmployeeList:true,SeatDetails:false,usageAnalytics:false,MainRadioBtnIndex:0,AddEmpBtn:true,DeleteEmpBtn:false,DeleteEmpBtnTT:"Remove Employee",Sync:true,teamID:t.teamID},empList:[],Seats:[]};var n=[];var l={};var i=`teamID eq '${t.teamID}'`;$.get({url:"/seat-booking/TeamEmployeeMasterWithName",headers:{"x-csrf-token":"fetch"},data:{$filter:i},success:function(e,t,a){n=e},async:false});if(n.value){n.value.forEach(e=>{l.employeeID_ID=e.employeeID_ID;l.role_roleCode=e.role_roleCode;l.empIDEdit=false;l.name=e.employeeName;if(l.role_roleCode==="01"){l.roleOptionEdit=false}else{l.roleOptionEdit=true}s.empList.push(l);l={}})}var p=this._controller.getView();var f=new sap.ui.model.json.JSONModel(s);p.setModel(f,"modelData");var c=new sap.ui.model.json.JSONModel(JSON.parse(JSON.stringify(s)));p.setModel(c,"ExistingData");if(!this._oDialogonManagerZone){this._oDialogonManagerZone=sap.ui.xmlfragment(p.getId(),"seatbookingui.ext.fragments.managerZone",this);p.addDependent(this._oDialogonManagerZone)}this._oDialogonManagerZone.open()}}},SaveManagerBooking:function(e){alert("save called")},AddEmployee:function(e){var t=e.getSource().getModel("modelData");var a={employeeID_ID:"",role_roleCode:"02",roleOptionEdit:true,name:"",empIDEdit:true};t.getData().empList.unshift(a);t.refresh()},onEmpListSelectionChange:function(e){var t=e.getSource().getModel("modelData");var a=t.getProperty(e.getSource().getSelectedContextPaths()[0]);if(a.role_roleCode==="01"&&a.empIDEdit===false){t.setProperty("/Property/DeleteEmpBtn",false);t.setProperty("/Property/DeleteEmpBtnTT","Manager cannot be removed from this screen")}else{t.setProperty("/Property/DeleteEmpBtn",true);t.setProperty("/Property/DeleteEmpBtnTT","Press to remove selected employee from your team")}},SyncData:function(e){sap.m.MessageToast.show("Action in process, It will fetch data from SAP Employee DB for the manager")},DeleteEmp:function(e){var t=this;var a;if(e.getSource().getParent().getParent().getSelectedContextPaths()){var o=e.getSource().getParent().getParent().getSelectedContextPaths();if(o[0]){var r=e.getSource().getModel("modelData");var n=o[0].split("/").pop();var l=r.getData().empList[n];var i=this._controller.getView().getModel("ExistingData").getData().empList;var p=i.find(function(e){return e.employeeID_ID===l.employeeID_ID});if(p){$.ajax({url:"/seat-booking/TeamEmployeeMaster/"+l.employeeID_ID,type:"DELETE",headers:{"Content-Type":"application/json"},success:function(e){a=true;s(t)},error:function(e){a=false},async:false})}r.getData().empList.splice(n,1);e.getSource().getParent().getParent().removeSelections();r.setProperty("/Property/DeleteEmpBtn",false);this._controller.getView().getModel("modelData").refresh();sap.m.MessageToast.show("Employee removed!")}}},ShowEmpName:function(e){var t=l(e.getParameter("value").toUpperCase());if(!t){name="unknownUser/WrongID"}else{name=t.name}e.getSource().getModel("modelData").setProperty(e.getSource().getBindingInfo("value").binding.getContext().getPath()+"/name",name)},SaveEmployee:function(){var e={},t,a=[];var o,r,n=this;var i=`employeeID_ID eq '${sap.ushell.Container.getService("UserInfo").getId()}'`;var p,f=[];$.get({url:"/seat-booking/TeamEmployeeMaster",headers:{"x-csrf-token":"fetch"},data:{$filter:i},success:function(e,t,a){p=a.getResponseHeader("x-csrf-token");f=e},async:false});if(f.value){if(f.value[0]){t=f.value[0].teamID}}var c=this._controller.getView().getModel("modelData");var u=this._controller.getView().getModel("ExistingData");var g=u.getData().empList;c.getData().empList.forEach(a=>{e.employeeID_ID=a.employeeID_ID.toUpperCase();e.role_roleCode=a.role_roleCode;e.teamID=t;var r=g.find(function(t){return t.employeeID_ID===e.employeeID_ID});if(r){if(r.role_roleCode===e.role_roleCode){r=undefined;return}}else{if(l(e.employeeID_ID)){i=`employeeID_ID eq '${e.employeeID_ID}'`;$.get({url:"/seat-booking/TeamEmployeeMaster",data:{$filter:i},success:function(e,t,a){f=e},async:false});if(f.value){if(f.value[0]){if(f.value[0].teamID!==e.teamID){o="Fail";sap.m.MessageToast.show(`Employee '${e.employeeID_ID}' already added for team '${f.value[0].teamID}'`);return}}}}else{sap.m.MessageToast.show(` '${e.employeeID_ID}'ID is not correct & will not be saved`);o="Fail";return}}$.ajax({url:"/seat-booking/TeamEmployeeMaster/"+e.employeeID_ID,type:"PUT",headers:{"x-csrf-token":p,"Content-Type":"application/json"},data:JSON.stringify(JSON.parse(JSON.stringify(e))),success:function(e){s(n)},error:function(e,t){const a="fail";o=a},async:false})});if(o==="Fail"){}else{sap.m.MessageToast.show("Data saved successfully")}},CancelManagerBooking:function(){this._oDialogonManagerZone.close()},SaveSeat:function(e){var t,a=this;var o=this._controller.getView().getModel("modelData");var r=this._controller.getView().getModel("ExistingData");var n=r.getData().Seats;o.getData().Seats.forEach(e=>{var o=n.find(function(t){return t.seatID===e.seatID&&t.monitorCount===e.monitorCount&&t.facility1===e.facility1&&t.facility2===e.facility2});if(o)return;else{e.facility1=parseInt(e.facility1);e.facility2=parseInt(e.facility2);e.monitorCount=parseInt(e.monitorCount);$.ajax({url:"/seat-booking/TeamSeatMapping/"+e.seatID,type:"PUT",headers:{"Content-Type":"application/json"},data:JSON.stringify(JSON.parse(JSON.stringify(e))),success:function(e){s(a);t="success"},error:function(e,a){const o="fail";t=o},async:false})}});if(t==="fail"){}else{sap.m.MessageToast.show("Data saved successfully")}},ManagerTypeSelection:function(e){var t=this._controller.getView().getModel("modelData");var a=t.getProperty("/Property/MainRadioBtnIndex");if(a===0){t.setProperty("/Property/EmployeeList",true);t.setProperty("/Property/SeatDetails",false);t.setProperty("/Property/usageAnalytics",false)}else if(a===1){t.setProperty("/Property/EmployeeList",false);t.setProperty("/Property/SeatDetails",true);t.setProperty("/Property/usageAnalytics",false);i(e,this)}else if(a===2){t.setProperty("/Property/EmployeeList",false);t.setProperty("/Property/SeatDetails",false);t.setProperty("/Property/usageAnalytics",true)}}}});